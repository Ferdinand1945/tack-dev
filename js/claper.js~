$(document).ready(function () {
    var listaProductos = [];
    
    var carroCompras = [];
// $(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto")
    
    function inicio() {
        listaProductos = $(".claperProducto");
    }
/*    
    var filtrarCategoria = function(cat) {
        $(".claperProducto").slideUp(); 
        $('.claperProducto [value=Pizza]').parents().slideDown();
    }
*/
    inicio();
    $('#btnPedir').hide();
    
    $(".categories").click(function () {
        $("#categoria").text(this.innerText);
        $(".claperProducto").hide();
        var criterio = ".claperProducto [value=" + this.innerText + "]";
        $(criterio).parents().slideDown();
    });


    $('.close_shopping_cart_holder').on('click', function () {
        if ($('#items_in_shopping_cart').text() === '0') {
            $('#btnPedir').fadeOut(800);
        }
    });
    
    $('.claperProducto').on("change", function () {
//alert("charly putaso");        
$("#items_in_shopping_cart").text($(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto").length);
if (($(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto")).length==0) {
    $('#btnPedir').fadeOut(800);
}else {
    $('#btnPedir').fadeIn( 800 );
}        
    });
                         
$(function(){
    
        
    // This button will increment the value
    $('.qtyplus').click(function(e) {
        // Stop acting like a button
        e.preventDefault();
// este control se hace cuando se cmabia el valor de QTY        
        $('#btnPedir').fadeIn( 800 );
        // nos quedamos con el nombre del boton, coincide con el ID del div que lo contiene
        var qty                   = parseInt($(this).parent('li').find('.qty').val())+1;
        var product_id            = parseInt($(this).parent('li').parent('div').attr('id'));    
        updatePopupCart(product_id,qty);          
        fieldName = $(this).attr('name');
        // nos quedamos con el valor que tiene el DIV en el campo quantity
        salida = $('#' + fieldName + ' [name=quantity]').val(qty);

// este control se debe hacer en .qty on change            
        $("#items_in_shopping_cart").text($(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto").length);
    });
    
    
    // This button will decrement the value till 0
    $(".qtyminus").click(function(e) {
        // Stop acting like a button
        e.preventDefault();
        if (parseInt($(this).parent('li').find('.qty').val())>0){
        // Get the field name
        fieldName = $(this).attr('name');
        // Get its current value
        var qty                   = parseInt($(this).parent('li').find('.qty').val())-1;
        var product_id            = parseInt($(this).parent('li').parent('div').attr('id'));   
        updatePopupCart(product_id,qty);                  
        salida = $('#'+fieldName+' [name=quantity]').val(qty);          
// este control se debe hacer en .qty on change   
$("#items_in_shopping_cart").text($(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto").length);
if (($(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto")).length==0) {
$('#btnPedir').fadeOut(800);
}    
        }
    });
    
        function updatePopupCart(product_id,qty){
        // console.log('product_id='+product_id+'&qty='+qty);
            $.ajax({
                url: "popup-cart-ajax.php",
                data: 'product_id='+product_id+'&qty='+qty+'&command=updatePopupCart',
                success: function(response){
                    console.log(response);
                }
            });
        }
    
});

//   $('.btnPe').on('click', function(){
//       $('.shopping_cart_info_holder').append();
//       $(".claperProducto [name=quantity]").filter(function(){return this.value>0}).parents(".claperProducto");
//   });
    
});