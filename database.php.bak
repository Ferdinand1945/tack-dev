<?php

/* This file contains methods to connect to DB, search for elements etc.....*/

/* Request MySQL Conf file with credentials */	
require_once("dbConf.php");

class MySQLDatabase
{
    private $connection;
    public $last_query;
   
    private $dbMenuItems="menuItems";
    public $imageCategories = array('Comidas','Bebidas','Postres');
    
 
    function __construct(){
        $this->open_connection();
    }

    public function open_connection(){
        try{
            $this->connection = new mysqli(DB_SERVER, DB_USER, DB_PASSWORD, DB_NAME);
        }catch(Exception $except){
            die("Unable to connect to Database");
        }
    }
    

    public function close_connection(){
        if(isset($this->connection)){
            $this->connection->close();
            unset($this->connection);
        }
    }
    
 
    public function query($sql){
        $this->last_query = $sql;
        $result = mysqli_query($this->connection, $sql);
        $this->confirm_query($result); 
        return $result;
    }
    
 
    private function confirm_query($result){
        if(!$result){
            $output = "Database query failed: " . mysqli_error($this->connection) . "<br />";
            $output .= "Last MySQL Query: " . $this->last_query;
           die($output);  
        }
    }
   

    public function fetch_array($result){
        return mysqli_fetch_array($result);
    }
    
    public function find_by_query($query=""){
        global $database;
        $result = $this->query($query);
        $arrayWithData = array();
        while($row = $this->fetch_array($result)){
            $arrayWithData[]=$row;
        }
        $this->close_connection();
        return $arrayWithData;   
    }
        

    public function findMenuItem(){
        global $database;
        $result = $database->query("SELECT * FROM ".$this->dbMenuItems." ORDER BY id ASC");
        $object_array = array();

        while($row = $database->fetch_array($result)){
            $object_array[]=$row;
        }

        return $object_array;          
   
        $this->close_connection();
    }    
    

    public function getFileCategories(){
        $categories = $this->imageCategories;
        return $categories;
    }      
}

$database = new MySQLDatabase();






?>